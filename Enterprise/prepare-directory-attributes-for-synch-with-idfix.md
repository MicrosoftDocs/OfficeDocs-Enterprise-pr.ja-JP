---
title: IdFix ツールを使用して Microsoft 365 との同期のためにディレクトリ属性を準備する
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
audience: Admin
ms.topic: article
ms.service: o365-administration
localization_priority: Normal
f1.keywords:
- CSH
ms.custom: Adm_O365
ms.collection:
- Ent_O365
- M365-identity-device-management
search.appverid:
- MET150
- MOE150
ms.assetid: 497593cf-24c6-491c-940b-7c86dcde9de0
description: Microsoft 365 に同期する前に、IdFix を使用してオンプレミスのディレクトリを準備およびクリーンアップする方法について説明します。
ms.openlocfilehash: cae1df048e58c65a3203ea39df18beb986adb0c8
ms.sourcegitcommit: c112869b3ecc0f574b7054ee1edc8c57132f8237
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/15/2020
ms.locfileid: "44736005"
---
# <a name="prepare-directory-attributes-for-synchronization-with-microsoft-365-by-using-the-idfix-tool"></a>IdFix ツールを使用して Microsoft 365 との同期のためにディレクトリ属性を準備する

*この記事は、Microsoft 365 Enterprise と Office 365 Enterprise の両方に適用されます。*

このトピックでは、IdFix ツールの実行方法、発生する可能性のある一般的なエラー、推奨される修正、例、および多数のエラーが発生した場合の対処に関するベストプラクティスについて説明します。
  
## <a name="fixing-errors-in-your-directory-by-using-the-idfix-gui"></a>IdFix GUI を使用してディレクトリ内のエラーを修正する

[Microsoft 365 IdFix ツールを実行](install-and-run-idfix.md)して、ディレクトリ内の問題を検索し、このトピックで説明されているように GUI でエラーを修正します。 ツールによって空のテーブルが返された場合、エラーは検出されませんでした。 ディレクトリに多くの問題がある場合は、ツールがエラーを返したときに過剰な問題が発生する可能性があります。 これを解決する1つの方法は、1つの型のすべてのエラーを修正してから、次の種類に進むことです。 
  
1. 変更を開始する前に、IdFix によって提示された推奨事項を参照してください。
    
2. IdFix によって返されたエラーの一覧を確認します。 エラーの種類を一覧表示する列の上部にある [**エラー** ] をクリックすると、エラーの種類別にエラーを並べ替えることができます。 1つの属性に複数のエラーが関連付けられている場合は、エラーが1つの行に結合されます。 可能な場合は、IdFix で、[**更新**] 列の修正に関する推奨事項が提供されます。 この修正プログラムは、オブジェクトに関連付けられている他の属性のチェックに基づいています。 これらは通常、ディレクトリ内にあるものよりも優れていますが、実際に正確なものを決定するだけで済みます。 
    
3. IdFix で重複エラーを修正するための提案がある場合、修正は、[**更新**] 列の値の先頭にある3つのフラグのいずれかによって識別されます (例 `[E]john.doe@contoso.com` :)。 提案を承諾した場合、変更を適用すると、フラグはディレクトリに挿入されません。 候補フラグの後の値のみが適用されます (例:) `john.doe@contoso.com` 。 提案を承諾する場合は、[**アクション**] 列の [照合する] アクションを選択します。 Flags は、次のようなアクションを示します。 
    
 - **[C]** 推奨されるアクションが**完了**しました。 値を編集する必要はありません。
    
 - **[E]** 推奨されるアクションの**編集**。 この値は、ディレクトリ内の別の値と競合しないように変更する必要があります。
    
 - **[R]** アクションを**削除**することを推奨します。 この値は、メールが有効でないオブジェクト上の SMTP プロキシであり、安全に削除されている可能性があります。
    
4. エラーを読んで理解した後、変更内容で [**更新**] 列のエントリを更新し、[**アクション**] 列で変更を実装するために idfix を実行する対象を選択します。 たとえば、2人のユーザーが重複を識別している可能性があり `proxyAddress` ます。 メール配信には、1人のユーザーしか使用でき `proxyAddress` ません。 この問題を解決するに**ACTION**は、**ユーザーの [アクション] 列の**値を適切に設定し、他のユーザーに対して [**アクション**] 列の**削除**をマークします。 これ `proxyAddress` により、これが属していないユーザーの属性が削除され、 `proxyAddress` そのユーザーに対して適切な変更を行うことはできません `proxyAddress` 。
    
## <a name="common-errors-and-fixes-detected-by-idfix"></a>IdFix によって検出された一般的なエラーと修正プログラム
次の表では、IdFix によって検出されたエラーと、ツールから最も一般的に推奨される修正策について説明します。場合によっては、それらの修正方法の例も示します。

|**エラー**|**エラーの種類の説明**|**推奨される修正**|**例**|
|:-----|:-----|:-----|:-----|
|**character** | 無効な文字です。 値に無効な文字が含まれています。 | [**更新**] 列に表示されるエラーの修正候補は、無効な文字が削除された値を示しています。  <br/> | 有効なメールアドレスの末尾にある末尾のスペースは、次の例のような無効な文字です。  <br/> " `user@contoso.com` "  <br/> 有効なメールアドレスの先頭にある先頭のスペースは、次の例のような無効な文字です。  <br/> " ` user@contoso.com `"  <br/>  `ú`文字が無効な文字です。 |
|**レプリケーション** | エントリが重複しています。 値は、クエリの範囲内で重複しています。 重複する値はすべてエラーとして表示されます。 | 値を編集または削除して、重複を排除します。 このツールは、重複に関する推奨される修正プログラムを提供しません。 代わりに、2つ以上の重複が正しいものかどうかを選択して、重複するエントリまたはエントリを削除する必要があります。 ||
|**format** | 書式設定のエラーです。 値が属性の使用法の形式要件に違反しています。 | 推奨される更新プログラムによって、無効な文字が削除された値が表示されます。 無効な文字がない場合は、Update と Value は同じように表示されます。 更新プログラムで本当に必要なものを特定する必要があります。 このツールは、すべての書式設定エラーについて推奨される修正プログラムを提供しません。 | たとえば、SMTP アドレスは RFC 2822 に準拠している必要があります。また、mailNickName をピリオドで開始または終了することはできません。 ディレクトリ属性の形式要件の詳細については、「 [Prepare to プロビジョニングユーザーによるディレクトリ同期を通して Microsoft 365 に通知する](prepare-for-directory-synchronization.md)」の「ディレクトリオブジェクトと属性の準備」を参照してください。 |
|topleveldomain  <br/> |トップレベルのドメイン。 これは、 [RFC 2822](https://go.microsoft.com/fwlink/p/?LinkId=401464)の書式設定に従う値に適用されます。 最上位のドメインがインターネットにルーティングできない場合は、エラーとして識別されます。 たとえば、. ローカルで終わる SMTP アドレスは、インターネットにルーティングできないため、このエラーが発生します。 |値を、またはなどのインターネットルーティング可能なドメインに変更し `.com` `.net` ます。 | `myaddress@fourthcoffee.local` `fourthcoffee.com` または別のインターネットルーティング可能なドメインに変更します。  <br/> 手順については、「[ルーティング不能なドメイン (たとえば、ローカルドメイン) をディレクトリ同期用に準備する方法](prepare-a-non-routable-domain-for-directory-synchronization.md)」を参照してください。 |
|**domainpart** | ドメイン部分のエラーです。 これは、RFC 2822 の書式設定に従う値に適用されます。 値のドメイン部分が無効で、RFC 2822 に準拠していない場合は、これが生成されます。 | 値を RFC 2822 に準拠する値に変更します。 たとえば、スペースまたは無効な文字が含まれていないことを確認してください。 | `myaddress@fourth coffee.com`をに変更 `myaddress@fourthcoffee.com` します。 |
|**domainpart_localpart** | ローカルパーツエラー。 これは、RFC 2822 の書式設定に従う値に適用されます。 値のローカル部分が無効で、RFC 2822 に準拠していない場合は、これが生成されます。 |値を RFC 2822 に準拠する値に変更します。 たとえば、スペースまたは無効な文字が含まれていないことを確認してください。 |`my"work"address@fourthcoffee.com`をに変更 `myworkaddress@fourthcoffee.com` します。 |
|**length** | 長さのエラーです。 値が属性の長さ制限に違反しています。 これは、ディレクトリスキーマが変更されたときに最もよく発生します。  | IdFix によって提案される更新プログラムは、許容可能な長さまで値を切り捨てます。  <br/> これは望ましくない結果になる可能性があることに注意してください。 [**適用**] をクリックする前に、推奨される修正内容を確認し、必要に応じて変更してください。 ||
|**空白**  | 空白または null エラー。 値は、属性が同期されるための null 制限に違反しています。 値を含める必要があるのは、いくつかの属性のみです。 | 可能であれば、推奨される更新プログラムによって、他の属性値が利用されている可能性があります。 ||
|**mailmatch** | これは、Microsoft 365 専用のみに適用されます。 値が mail 属性と一致しません。 | 推奨される更新プログラムは、"SMTP:" で始まるメール属性値になります。 ||
    
## <a name="operations-you-can-perform-by-using-idfix"></a>IdFix を使用して実行できる操作
エラーを修正するには、[**アクション**] ドロップダウンリストからオプションを選択します。 次の表では、IdFix ツールを使用して属性に対して実行できる**操作**操作について説明します。 [**アクション**] 列を空のままにしておくと、idfix ツールでは、ディレクトリ内の特定のエラーに対する操作は実行されません。 

|**ACTION**|**アクションの説明**|**例**|
|:-----|:-----|:-----|
|**COMPLETE** | 元の値は受け入れ可能で、エラーとして識別されていても変更できません。 | 2人のユーザーが重複していると識別された proxyAddress を持っている。 メール配信に対して使用できる値は1つだけです。 ユーザーの正しい値を**完了**としてマークします。 |
|**REMOVE** | 属性の値は、ソースオブジェクトから削除されます。 たとえば、複数値属性の場合は `proxyAddresses` 、表示されている個々の値のみが削除されます。 | 2人のユーザーが重複していると識別された proxyAddress を持っている。 メール配信に対して使用できる値は1つだけです。 重複する値を持つユーザーを**削除**としてマークします。 |
|**修正** | [**更新**] 列の情報は、属性値を変更するために使用されます。 有効な**更新プログラム**の値が idfix によって提案されている場合は、[**アクション**] 列から [**編集**] を選択し、次のエラーに進みます。 提案が気に入らない場合は、[**更新**] 列に新しい候補を入力し、[**アクション**] 列で [**編集**] を選択します。 ||
|**操作** | このオプションは、トランザクションログから復元した場合にのみ使用できます。 [元に**戻す**] を選択すると、属性の値が元の値に復元されます。 ||
|**FAIL** | この値は、**更新**値が AD DS ルールとの間で不明な競合を持っている場合にのみ返されます。 この場合、エラーの内容がわかっていれば、[**更新**] 列の値をもう一度編集できます。 ADSI エディターを使用して、オブジェクトの値を分析する必要がある場合があります。 詳細については、「 [ADSI edit (adsiedit)](https://go.microsoft.com/fwlink/p/?LinkId=401170)」を参照してください。 ||

エラーまたはエラーのバッチに対する**アクション**を選択した後、[**適用**] をクリックします。 [**適用**] をクリックすると、ツールによってディレクトリ内の変更が行われます。 複数のエラーを修正してから [**適用**] をクリックすると、すべてのエラーが同時に変更されます。

IdFix を再度実行して、修正によって新しいエラーが発生しなかったことを確認します。 必要な回数だけこれらの手順を繰り返すことができます。 同期する前に、このプロセスを何度か実行することをお勧めします。
    
## <a name="changing-the-rule-set-used-by-idfix"></a>IdFix で使用されるルールセットの変更
既定では、IdFix はマルチテナントルールセットを使用して、ディレクトリ内のエントリをテストします。 これは、ほとんどの Microsoft 365 お客様のための適切なルールセットです。 ただし、Microsoft 365 専用または ITAR (肘掛けされた国際トラフィック) お客様の場合は、IdFix を構成して、代わりに専用のルールセットを使用することができます。 お客様の種類がわからない場合は、この手順を省略しても問題ありません。 ルールセットを専用に設定するには、メニューバーの歯車アイコンをクリックして、[**専用**] をクリックします。
  
## <a name="changing-the-scope-of-the-search-used-by-idfix"></a>IdFix で使用される検索範囲の変更
既定では、IdFix はディレクトリ全体を検索します。 必要に応じて、代わりに特定のサブツリーを検索するようにツールを構成できます。 これを行うには、メニューバーで [フィルター] アイコンをクリックし、有効なサブツリーを入力します。
  
## <a name="rolling-back-your-changes-by-using-the-idfix-gui"></a>IdFix GUI を使用して変更をロールバックする
[**適用**] をクリックして変更を適用するたびに、idfix ツールは、加えた変更を一覧表示するトランザクションログと呼ばれる個別のファイルを作成します。 トランザクションログを使用して、誤った変更を行った場合に最新のログに含まれていた変更のみをロールバックすることができます。 更新中に間違いを犯した場合は、[**元に戻す**] をクリックすると、最近適用した変更を元に戻すことができます。 [元に**戻す**] をクリックすると、idfix は、トランザクションログを使用して、最新のトランザクションログにある変更のみをロールバックします。 トランザクションログの使用の詳細については、「 [Microsoft 365 IdFix トランザクションログ](idfix-transaction-log.md)」を参照してください。

## <a name="next-step"></a>次の手順

[ディレクトリ同期をセットアップする](set-up-directory-synchronization.md)
