---
title: "アクセス可能な図 - Microsoft Azure に対する SharePoint の障害復旧"
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
ms.date: 12/15/2017
ms.audience: ITPro
ms.topic: article
ms.collection: Ent_O365
ms.service: o365-solutions
localization_priority: Normal
ms.assetid: 4b855224-8e67-4efa-a3a4-908ee0ca6412
description: "この資料は、「Microsoft Azure に対する SharePoint の障害復旧」という名前の図のアクセス可能なテキスト バージョンです。"
ms.openlocfilehash: 545aaae05e3becbde60fe01c0e50e5610ee69f98
ms.sourcegitcommit: d1a1480982c773f2241cb17f85072be8724ea841
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/09/2018
---
# <a name="accessible-diagram---sharepoint-disaster-recovery-to-microsoft-azure"></a>アクセス可能な図 - Microsoft Azure に対する SharePoint の障害復旧

**概要:** この資料は、「Microsoft Azure に対する SharePoint の障害復旧」という名前の図のアクセス可能なテキスト バージョンです。
  
このポスターは、Azure で回復環境を構築するためのアーキテクチャの例を示します。 
  
## <a name="on-premises-environment-with-an-azure-recovery-environment"></a>Azure 回復環境のあるオンプレミスの環境

この図は、Azure を回復に使用するオンプレミス環境の運用環境のためのアーキテクチャの例を示します。 
  
### <a name="on-premises-production-environment"></a>オンプレミスの運用環境

付属する図は、サーバー ファーム内の 4 つの階層のある実際の運用環境サーバーを示します。 
  
#### <a name="tier-1"></a>階層 1

フロント エンド サービスとクエリ処理の 2 つのサーバーがあります。両方のサーバーのレプリカを提供するインデックス パーティションがあります。 
  
#### <a name="tier-2"></a>階層 2

この層内には、分散キャッシュの 2 つのサーバーがあります。 
  
#### <a name="tier-3"></a>階層 3

この階層には 3 つのサーバーがあります。各サーバーは、次のサービスを提供します。 
  
- バックエンド サービス 
    
- 管理者 
    
- Workflow Manager 
    
- クロール 
    
- コンテンツ処理 
    
- 分析 
    
#### <a name="tier-4"></a>階層 4

この階層には 2 つのサーバーがあります。両方のサーバーには次のような 3 つの可用性グループがあります。 
  
- 可用性グループ 1 は検索機能を提供します。 
    
- 可用性グループ 2 は、コンテンツ、構成、およびサービス アプリケーションを提供します。 
    
- 可用性グループ 3 はコンテンツを提供します。 
    
この階層には、ファイル共有サーバーもあります。階層 4 のサーバーは、このサーバーと通信するためにログ配布を使用します。次いで、このサーバーは、次のセクションで説明するように、通信分散ファイル システム レプリケーション (DFSR) 経由で、Azure ウォーム スタンバイ回復環境のファイル共有サーバーと通信します。 
  
### <a name="azure-recovery-environment"></a>Azure 回復環境

#### <a name="warm-standby-environment-running-virtual-machines"></a>仮想マシンを実行するウォーム スタンバイ環境

付属する図は、Azure 回復環境に正確に複製されたオンプレミス環境を示します。この環境でのファイル共有サーバーは、オンプレミス環境に DFSR でリンクされます。DFSR は、ファイル共有サーバーにより、ログを運用環境から回復環境に転送します。 
  
### <a name="overview"></a>概要

オンプレミス SharePoint 2013 ファームの障害復旧環境は、Azure でホストできます。 
  
-  Azure インフラストラクチャ サービスは、セカンダリ データ センターを提供します。
    
- 支払いは、使用したリソースの分だけです。 
    
- 小規模の回復ファームは、障害後に目標とする規模と容量に合わせてスケール アウトできます。 
    
Azure の回復ファームは、オンプレミスの運用ファームと可能な限り同じように構成されます。 
  
- サーバー ロールの同じ表現。 
    
- カスタマイズの同じ構成。 
    
- 検索機能の同じ構成 (より小さいバージョンの運用ファーム上に構成できます)。 
    
ログ配布と DFSR を使用して、データベース バックアップとトランザクション ログを Azure ファームへコピーします。 
  
- DFSR を使用して、ログを運用環境から復旧環境に転送します。WAN シナリオの場合、DFSR の方が、ログを Azure 内のセカンダリ サーバーに直接配布するよりも効率的です。 
    
- Azure ベースの SQL Server コンピューターにログが再生されます。 
    
- ログ配布データベースは、復旧手順を実行するまで、ファームに接続されません。 
    
フェイル オーバー手順: 
  
1. ログ配布を停止します。 
    
2. プライマリ ファームへのトラフィックの受け入れを停止します。 
    
3. 最後のトランザクション ログを再生します。 
    
4. コンテンツ データベースをファームに接続します。 
    
5. フル クロールを開始します。 
    
6. レプリケートされたサービス データベースに基づいてサービス アプリケーションを復元します。 
    
このソリューションによって提供される回復目標は次のとおりです。 
  
- サイトおよびコンテンツ 
    
- 検索 (再クロールされます。検索履歴はありません) 
    
- サービス
    
マイクロソフト コンサルティング サービスまたはパートナーによって対処できる追加項目: 
  
- カスタム ファーム ソリューションの同期 
    
- オンプレミスのデータ ソースへの接続 (ビジネス データ接続 (BDC) と検索コンテンツ ソース) 
    
- 検索の復元シナリオ 
    
- 回復時刻の目標 (RTO) と回復ポイントの目標 (RPO) 
    
#### <a name="cold-standby-environment-running-virtual-machines"></a>仮想マシンを実行するコールド スタンバイ環境

コールド スタンバイ環境は、起動に長い時間がかかりますが費用が安くてすみます。 
  
- ファームが完全にビルドされますが、ファームの作成後に仮想マシンが停止します。処理コストが発生するのは仮想マシンの実行中のみですが、ストレージとネットワーク データ転送のコストはかかります。 
    
- 障害時には、ファーム内のすべての仮想マシンを開始し修正プログラムを適用します。 
    
- バックアップとトランザクション ログがファーム データベースに適用されます。 
    
コールド スタンバイ環境の追加の手順を次に示します。 
  
- 仮想マシンの電源を定期的に入れ、修正、更新、環境の検証を行います。 
    
- DNS および IP アドレスを更新する手順を実行します。 
    
- フェールオーバー後に SQL AlwaysOn を設定します。 
    
付属の図は、仮想マシン上のレプリケートされた回復環境を示します。コールド スタンバイ環境へのフェイル オーバー後、すべての仮想マシンが起動し、データベース サーバーを使用可能にする再生ログを使用して可用性グループを構成します。 
  
## <a name="sharepoint-recovery-environment-in-azure"></a>Azure における SharePoint 回復環境

Azure でのフェールオーバー環境の設計と作成。 
  
- Azure で仮想ネットワークを作成します。 
    
- サイト間の VPN 接続によって、オンプレミスのネットワークを Azure の仮想ネットワークに接続します。この接続は Azure の動的なゲートウェイを使用します。 
    
- 1 つ以上のドメイン コントローラーを Azure 仮想ネットワークにデプロイし、オンプレミスのドメインと連携するよう構成します。これらのドメイン コントローラーはカタログ サーバーです。 
    
- SharePoint ファームをクラウド サービスと可用性の設定に適合させます。 
    
- SharePoint ファームとファイル サーバーをデプロイして、ファイル共有をホストします。 
    
- オンプレミス環境と Azure ベースの回復環境の間に、ログ配布と DFSR を設定します。 
    
付属の図は、次の機能のある、オンプレミス環境と Azure 仮想ネットワークを示します。 
  
### <a name="on-premises-environment"></a>社内環境

- Windows Server 2012 RRAS 
    
- Active Directory サーバー 
    
オンプレミスのネットワークは、仮想プライベート ネットワーク (VPN) ゲートウェイ経由で Azure 仮想ネットワークとインターフェイスをとります。 
  
### <a name="azure-virtual-network"></a>Azure 仮想ネットワーク

VPN ゲートウェイは、アクティブな VPN ゲートウェイのサブネットとインターフェイスをとります。 
  
Azure 仮想ネットワークには 3 つのクラウド サービスがあります。 
  
- 最初のクラウド サービスには、Active Directory サーバーと DNS サーバーという 2 つのサーバーと、1 つの可用性セットがあります。 
    
- 2 番目のクラウド サービスには、3 つのサーバー セットがあります。 2 つの分散キャッシュ サーバーと 1 つの可用性セット。 2 つの分散フロントエンド サーバーと 1 つの可用性セット。 3 つのバックエンド サーバーと 1 つの可用性セット。
    
- 3 番目のクラウド サービスには、3 つのデータベース サーバーと 1 つの可用性セットがあります。これらのデータベース サーバーの 1 つは、ログ配布のファイル共有と SQL Server AlwaysOn のノード マジョリティの 3 番目のノードです。 
    
### <a name="build-the-ad-ds-hybrid-environment"></a>AD DS ハイブリッド環境の構築

このソリューションの AD DS の構成は、ハイブリッド展開のシナリオを構成しています。このシナリオでは、AD DS はオンプレミスに部分的にデプロイされ、Azure 仮想マシンに部分的にデプロイされます。 
  
重要 — AD DS を Azure にデプロイする前に、「Microsoft Azure Virtual Machines での Windows Server Active Directory のデプロイ ガイドライン  (http://msdn.microsoft.com/ja-jp/library/windowsazure/jj156090.aspx)」をお読みください。 
  
Active Directory 環境の設計およびデプロイに関する詳細なガイダンスについては、http://TechNet.microsoft.com を参照してください。 
  
この参照アーキテクチャには、ドメイン コントローラーとして構成されている 2 つの仮想マシンが含まれています。それぞれ次のように構成されます。 
  
- サイズ — 小。 
    
- オペレーティング システム — Windows Server 2012。 
    
- ロール  グローバル カタログ サーバーとして割り当てられる AD DS ドメイン コントローラー。この構成は、VPN 接続経由の出力トラフィックを減少させます。変更度の高い複数ドメイン環境では、ドメイン コントローラーをオンプレミスで構成して、Azure のグローバル カタログ サーバーと同期しないようにします。 
    
- データ ディスク  AD DS データベース、ログ、SYSVOL を Azure データ ディスクに配置します。オペレーティング システム ディスク、または Azure によって提供される一時ディスクには配置しないでください。これは重要です。 
    
- ロール  ドメイン コントローラーに Windows DNS をインストールして構成します。 
    
- IP アドレス  動的 IP アドレスを使用します。そのため、Azure Virtual Network を作成する必要があります。 
    

